<!DOCTYPE html>
<html lang="ko"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{cmmn/layout}">
	
<section layout:fragment="content">
	<h1>계층형 게시판</h1>
	<div class="container">
		
<table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th style="width: 7%">글번호</th>
                <th scope="col">제목</th>
                <th style="width: 5%">작성자</th>
                <th style="width: 7%">날짜</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="text-center" scope="row" data-id="1">글번호1</td>
                <td class="text-overflow" style="max-width: 300px;">글제목1</td>
                <td class="text-overflow" style="max-width: 100px;">작성자1</td>
                <td class="text-center">날짜1</td>
            </tr>
            <tr>
                <td class="text-center" scope="row" data-id="1">글번호1</td>
                <td class="text-overflow" style="max-width: 300px;">글제목1</td>
                <td class="text-overflow" style="max-width: 100px;">작성자1</td>
                <td class="text-center">날짜1</td>
            </tr>
            <tr>
                <td class="text-center" scope="row" data-id="1">글번호1</td>
                <td class="text-overflow" style="max-width: 300px;">글제목1</td>
                <td class="text-overflow" style="max-width: 100px;">작성자1</td>
                <td class="text-center">날짜1</td>
            </tr>
        </tbody>
    </table>

<div align="right" class="col-md-12 left">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#savePostsModal">글 등록</button>
    </div>
<div class="center-block" style="width: 300px;padding:15px;">
 <nav aria-label="Page navigation">
  <ul class="pagination">
    <li class="page-item"><a class="page-link" href="#">Previous</a></li>
    <li class="page-item"><a class="page-link" href="#">1</a></li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item"><a class="page-link" href="#">3</a></li>
    <li class="page-item"><a class="page-link" href="#">Next</a></li>
  </ul>
</nav>
</div>
</div>
    <div class="modal fade" id="savePostsModal" tabindex="-1" role="dialog" aria-labelledby="savePostsLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="savePostsLabel">게시글 등록</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form enctype="multipart/form-data" th:action="@{/post/save}" method="post" id="write-frm">
                        <div class="form-group">
                            <label for="title">제목</label>
                            <input type="text" class="form-control" name="title" id="title" placeholder="제목을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label for="author"> 이미지 </label>
                            <input type="file" class="form-control" name="images" id="images" placeholder="이미지 첨부" multiple>
                        </div>
                        <div class="form-group">
                            <label for="content"> 내용 </label>
                            <textarea class="form-control" name="content" id="content" placeholder="내용을 입력하세요"  style="resize: none; height: 300px;"></textarea>
                        </div>
                    </form>
                                     <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="btn-write">등록</button>
                </div>
                </div>

            </div>
        </div>
    </div>
    <script>
    	let board = {
    		init: function() {
    			this.clickWriteBtn();
    		},
    		csrf: {
    			token: $("meta[name='_csrf']").attr("content"),
    			header: $("meta[name='_csrf_header']").attr("content")
    		},
    		cheackImageFiles: function() {
    			let imageInput = $('#images')[0];
    			let files = imageInput.files;
    		},
    		clickWriteBtn: function() {
    			let $this = this;
    			$("#btn-write").click(function() {
    				$this.cheackImageFiles();
    				let post = {
    					title : $("#title").val(),
    					content : $("#content").val(),
    					images: $('#images')[0].files
    				}
    				let test = new FormData();
    				test.append("title", "tq")
    				test.append("images", $('#images')[0].files)
    				console.log(test)
    				console.log(post)
     		        $.ajax({
			            type: 'POST',
			            url: '/post/save',
			            dataType: 'json',
			            //contentType: false,//'application/json; charset=utf-8',
			            processData: false,
			            enctype: 'multipart/form-data',
			            data: post,//post,//JSON.stringify(post),
			            beforeSend: function(xhr) {
		    				xhr.setRequestHeader($this.csrf.header, $this.csrf.token);
		    			}
			        }).done(function(result) {
			        	if (result.msg === "save") {
				        	alert("게시글이 등록되었습니다.");
				        	location.reload();
			        	} else {
			        		alert("게시글 등록에 실패했습니다. 다시 작성해주세요");
			        		location.reload();
			        	}
			        }).fail(function (error) {
			            console.log(error);
			        }); 
    			})
    		}
    	}
    	$(function() {
    		board.init()
/*     		$("#btn-write").click(function() {
    			$("#write-frm").submit();
    		}); */
    		$(".table tbody tr").click(function() {
    			console.log(this);
    			console.log(this.children)
    			console.log($(this).children("td").data("id"))
    			
    		})
    	})
    </script>
</section>


